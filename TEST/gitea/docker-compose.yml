#

x-service: &service
  logging: { options: { max-size: "1m" } }
  restart: "always"
  stop_grace_period: "5s"

services:
  gitea:
    << : *service
    image: "gitea/gitea"
    environment:
      - USER_GID=1000
      - USER_UID=1000
      - ROOT_URL=https://${HOST:?}.${DOMAIN:?}/gitea/
      - STATIC_URL_PREFIX=/gitea
    labels:
      - "traefik.enable=true"
      - "traefik.http.middlewares.gitea.stripprefix.prefixes=/gitea"
      - "traefik.http.routers.gitea.middlewares=auth@file,gitea"
      - "traefik.http.routers.gitea.rule=PathPrefix(`/gitea/`)"
      - "traefik.http.services.gitea.loadbalancer.server.port=3000"
    networks: [ "traefik" ]
    #ports: [ "127.0.0.1:22:22" ]
    volumes:
      - "./.local/gitea:/data"

networks:
  traefik: { external: true }
